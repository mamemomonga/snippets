<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<title></title>
<meta name="viewport" content="width=device-width">
<link rel="stylesheet" type="text/css" href="assets/prism.css" media="all">
<link rel="stylesheet" type="text/css" href="assets/index.css" media="all">
<script src="assets/prism.js"></script>
<script src="assets/index.js"></script>
</head>
<body>

<div class="container">
<a href="index.html">INDEX</a> | <a href="https://github.com/mamemomonga/snippets">GitHub</a><hr>
<h1 id="linux-debian-jessie-8-x-ubuntu-xenial-14-04-">Linux: Debian Jessie(8.x), Ubuntu xenial(14.04) の設定</h1>
<h2 id="-">ホスト名変更</h2>
<p>ホスト名を「THE_NEW_HOSTNAME」に設定して再起動</p>
<div class="code"><div class="controlform">THE_NEW_HOSTNAME: <input type="text" onchange="text_placeholder_change(this)" placeholder="THE_NEW_HOSTNAME"></div><pre class="line-numbers">
<code class="language-bash" data-config='{ "wrap":"sudo bash -xeu","placeholder":"THE_NEW_HOSTNAME" }'>NEW_HOSTNAME="THE_NEW_HOSTNAME"
echo "$NEW_HOSTNAME" > /etc/hostname
echo "127.0.0.1 localhost $NEW_HOSTNAME" > /tmp/hosts
sed -e '1d' /etc/hosts >> /tmp/hosts
cat /tmp/hosts > /etc/hosts
rm /tmp/hosts
reboot</code></pre>
<pre><code class="copyarea"></code></pre>
<input type="button" onclick="bt_copy_range(this)" value="コピー (sudo bash -xeu)"><br>
</div><h2 id="-">ローカルタイムを日本時間にする</h2>
<div class="code"><pre class="line-numbers">
<code class="language-bash" data-config='{ "wrap":"sudo bash -xeu" }'>rm /etc/localtime
ln -s /usr/share/zoneinfo/Asia/Tokyo /etc/localtime
echo 'Asia/Tokyo' > /etc/timezone
date</code></pre>
<pre><code class="copyarea"></code></pre>
<input type="button" onclick="bt_copy_range(this)" value="コピー (sudo bash -xeu)"><br>
</div><h2 id="-">ロケールが日本語だったら英語にする</h2>
<div class="code"><pre class="line-numbers">
<code class="language-bash" data-config='{ "wrap":"sudo bash -xeu" }'>if [ "$LANG" = "ja_JP.UTF-8" ]; then
    sed -i '/^# en_US.UTF-8 UTF-8/s/^# //' /etc/locale.gen
    locale-gen
    update-locale LANG=en_US.UTF-8
fi</code></pre>
<pre><code class="copyarea"></code></pre>
<input type="button" onclick="bt_copy_range(this)" value="コピー (sudo bash -xeu)"><br>
</div><h2 id="update-git-curl-wget">update, git, curl, wget</h2>
<div class="code"><pre class="line-numbers">
<code class="language-bash" data-config='{ "wrap":"sudo bash -xeu" }'>export DEBIAN_FRONTEND=noninteractive
apt-get update
apt-get -y upgrade
apt-get install -y git-core curl wget</code></pre>
<pre><code class="copyarea"></code></pre>
<input type="button" onclick="bt_copy_range(this)" value="コピー (sudo bash -xeu)"><br>
</div><h2 id="build-essential">build-essential</h2>
<div class="code"><pre class="line-numbers">
<code class="language-bash" data-config='{}'>sudo sh -c 'DEBIAN_FRONTEND=noninteractive apt-get install -y build-essential'</code></pre>
<pre><code class="copyarea"></code></pre>
<input type="button" onclick="bt_copy_range(this)" value="コピー"><br>
</div><h2 id="vim">vim</h2>
<div class="code"><pre class="line-numbers">
<code class="language-bash" data-config='{ "wrap":"sudo bash -xeu" }'>DEBIAN_FRONTEND=noninteractive apt-get install -y vim
cat > /etc/vim/vimrc.local << 'EOS'
syntax on
set wildmenu
set history=100
set number
set scrolloff=5
set autowrite
set tabstop=4
set shiftwidth=4
set softtabstop=0
set termencoding=utf-8
set encoding=utf-8
set fileencodings=iso-2022-jp,utf-8,cp932,euc-jp,ucs2le,ucs-2
set fenc=utf-8
set enc=utf-8
EOS
sudo sh -c "echo '3' | update-alternatives --config editor"</code></pre>
<pre><code class="copyarea"></code></pre>
<input type="button" onclick="bt_copy_range(this)" value="コピー (sudo bash -xeu)"><br>
</div><h2 id="ntp">NTP</h2>
<p>インストールと基本設定</p>
<div class="code"><pre class="line-numbers">
<code class="language-bash" data-config='{ "wrap":"sudo bash -xeu" }'>DEBIAN_FRONTEND=noninteractive apt-get install -y ntp
mv /etc/ntp.conf /etc/ntp.conf.orig

cat > /etc/ntp.conf << 'EOS'
driftfile /var/lib/ntp/drift
statistics loopstats peerstats clockstats
filegen loopstats file loopstats type day enable
filegen peerstats file peerstats type day enable
filegen clockstats file clockstats type day enable

restrict -4 default kod notrap nomodify nopeer noquery
restrict -6 default kod nomodify notrap nopeer noquery
restrict 127.0.0.1 
restrict ::1
EOS</code></pre>
<pre><code class="copyarea"></code></pre>
<input type="button" onclick="bt_copy_range(this)" value="コピー (sudo bash -xeu)"><br>
</div><p>参照先: 日本国内の場合</p>
<div class="code"><pre class="line-numbers">
<code class="language-bash" data-config='{ "wrap":"sudo bash -xeu" }'>cat >> /etc/ntp.conf << 'EOS'
server ntp1.jst.mfeed.ad.jp iburst
server ntp2.jst.mfeed.ad.jp iburst
server ntp3.jst.mfeed.ad.jp iburst
EOS</code></pre>
<pre><code class="copyarea"></code></pre>
<input type="button" onclick="bt_copy_range(this)" value="コピー (sudo bash -xeu)"><br>
</div><p>参照先: AmazonEC2の場合</p>
<div class="code"><pre class="line-numbers">
<code class="language-bash" data-config='{ "wrap":"sudo bash -xeu" }'>cat >> /etc/ntp.conf << 'EOS'
server 0.amazon.pool.ntp.org iburst
server 1.amazon.pool.ntp.org iburst
server 2.amazon.pool.ntp.org iburst
server 3.amazon.pool.ntp.org iburst
EOS</code></pre>
<pre><code class="copyarea"></code></pre>
<input type="button" onclick="bt_copy_range(this)" value="コピー (sudo bash -xeu)"><br>
</div><p>ntpd再起動と動作確認</p>
<div class="code"><pre class="line-numbers">
<code class="language-bash" data-config='{ "wrap":"sudo bash -xeu" }'>service ntp restart
sleep 10
ntpq -p</code></pre>
<pre><code class="copyarea"></code></pre>
<input type="button" onclick="bt_copy_range(this)" value="コピー (sudo bash -xeu)"><br>
</div><h2 id="postfix">postfix</h2>
<div class="code"><pre class="line-numbers">
<code class="language-bash" data-config='{ "wrap":"sudo bash -xeu" }'>DEBIAN_FRONTEND=noninteractive apt-get install -y postfix
sed -i.bak -e 's/^\(inet_protocols = all\)/#\1/' /etc/postfix/main.cf
echo 'inet_protocols = ipv4' >> /etc/postfix/main.cf
service postfix restart</code></pre>
<pre><code class="copyarea"></code></pre>
<input type="button" onclick="bt_copy_range(this)" value="コピー (sudo bash -xeu)"><br>
</div><h2 id="-sudo-">ユーザの追加とsudoユーザ</h2>
<p>パスワードなしでsudoできるユーザを作成する</p>
<p>rootで実行する</p>
<div class="code"><div class="controlform">ubuntu: <input type="text" onchange="text_placeholder_change(this)" placeholder="ubuntu"></div><pre class="line-numbers">
<code class="language-bash" data-config='{ "wrap":"bash -xeu","placeholder":"ubuntu" }'>NEW_USER=ubuntu
NEW_ID=1001
export DEBIAN_FRONTEND=noninteractive

groupadd -g $NEW_ID $NEW_USER
useradd -g $NEW_ID -u $NEW_ID -m -s /bin/bash $NEW_USER

apt-get install -y sudo
cat > /etc/sudoers.d/wheel_user << EOS
$NEW_USER ALL=(ALL) NOPASSWD:ALL
EOS
chmod 600 /etc/sudoers.d/wheel_user</code></pre>
<pre><code class="copyarea"></code></pre>
<input type="button" onclick="bt_copy_range(this)" value="コピー (bash -xeu)"><br>
</div>
<hr><a href="index.html">INDEX</a> | <a href="https://github.com/mamemomonga/snippets">GitHub</a>
</div>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-109885867-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-109885867-2');
</script>

</body>
</html>
